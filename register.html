<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar | SENAVISION</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#4f46e5;--primary-dark:#4338ca;--bg:#f8fafc;--card:#ffffff;--text:#0f172a;--muted:#64748b;--border:#e2e8f0;}
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;background:linear-gradient(135deg,#eef2ff,#f8fafc);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
        .card{width:100%;max-width:440px;background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px rgba(79,70,229,.15)}
        .header{padding:28px 28px 0;text-align:center}
        .brand{font-weight:700;font-size:20px;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
        .title{font-size:24px;font-weight:700;margin-top:8px}
        .subtitle{color:var(--muted);margin-top:4px}
        .body{padding:24px 28px 28px}
        .input{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:10px;font-size:14px}
        .field{margin-top:14px}
        .btn{width:100%;padding:12px 16px;border:none;border-radius:10px;font-weight:700;cursor:pointer;transition:.2s}
        .btn-primary{background:var(--primary);color:#fff}
        .btn-primary:hover{background:var(--primary-dark);transform:translateY(-1px)}
        .divider{display:flex;align-items:center;gap:12px;color:var(--muted);font-size:13px;margin:18px 0}
        .divider:before,.divider:after{content:"";height:1px;background:var(--border);flex:1}
        .btn-google{display:flex;align-items:center;justify-content:center;gap:10px;background:#fff;border:1px solid var(--border);color:#111827}
        .btn-google:hover{box-shadow:0 8px 24px rgba(0,0,0,.08);transform:translateY(-1px)}
        .footer{margin-top:14px;text-align:center;font-size:14px;color:var(--muted)}
        .footer a{color:var(--primary);text-decoration:none;font-weight:600}
        .error{color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;padding:10px;border-radius:8px;font-size:13px;display:none;margin-top:10px}
        .sr{position:absolute;left:-9999px}
    </style>
</head>
<body>
    <div class="card" role="form" aria-labelledby="formTitle">
        <div class="header">
            <div class="brand">SENAVISION</div>
            <div id="formTitle" class="title">Daftar</div>
            <div class="subtitle">Buat akun baru</div>
        </div>
        <div class="body">
            <div id="err" class="error" aria-live="polite"></div>

            <label class="field">
                <span class="sr">Nama</span>
                <input id="name" class="input" type="text" placeholder="Nama lengkap" autocomplete="name" required>
            </label>
            <label class="field">
                <span class="sr">Email</span>
                <input id="email" class="input" type="email" placeholder="Email" autocomplete="email" required>
            </label>
            <label class="field">
                <span class="sr">Password</span>
                <input id="password" class="input" type="password" placeholder="Password (min. 6 karakter)" autocomplete="new-password" required>
            </label>

            <button id="btnRegister" class="btn btn-primary" style="margin-top:14px">Daftar</button>

            <div class="divider"><span>atau</span></div>

            <button id="btnGoogle" class="btn btn-google" aria-label="Daftar dengan Google">
                <svg width="18" height="18" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path fill="#FFC107" d="M43.6 20.5H42V20H24v8h11.3C33.7 31.9 29.4 35 24 35c-6.6 0-12-5.4-12-12S17.4 11 24 11c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.6 5.3 29.6 3 24 3 12.3 3 3 12.3 3 24s9.3 21 21 21c10.5 0 19.3-7.6 21-17.5.3-1.6.5-3.3.5-5 0-1.6-.2-3.1-.5-4.5z"/>
                    <path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.8 16.3 19 13 24 13c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.6 5.3 29.6 3 24 3 16 3 9.1 7.2 6.3 14.7z"/>
                    <path fill="#4CAF50" d="M24 45c5.3 0 10.1-1.8 13.8-4.9l-6.4-5.3C29.4 35 26.9 36 24 36c-5.3 0-9.8-3.4-11.4-8l-6.6 5.1C8.8 41 15.9 45 24 45z"/>
                    <path fill="#1976D2" d="M43.6 20.5H42V20H24v8h11.3c-1 2.8-3 5-5.6 6.4l6.4 5.3C37.1 41 42 36 43.6 29.5c.3-1.6.5-3.3.5-5 0-1.6-.2-3.1-.5-4.5z"/>
                </svg>
                <span>Daftar dengan Google</span>
            </button>

            <div class="footer">Sudah punya akun? <a href="/login.html">Masuk</a></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, updateProfile, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js';
        import { getFirestore, doc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js';

        // TODO: Ganti dengan konfigurasi Firebase Anda
        const firebaseConfig = {
            apiKey: "AIzaSyDrKWMsQvJgtgGRvE2FEHPTnpq7MrKLQTQ",
            authDomain: "senavision-id.firebaseapp.com",
            projectId: "senavision-id",
            storageBucket: "senavision-id.firebasestorage.app",
            messagingSenderId: "1073477417711",
            appId: "1:1073477417711:web:681c33a68733fc2b35391a",
            measurementId: "G-7HJF81K0GE"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const $ = (id) => document.getElementById(id);
        const err = $("err");
        function showError(message){ err.style.display='block'; err.textContent = message; }
        function clearError(){ err.style.display='none'; err.textContent=''; }

        async function upsertUser(user, extra = {}) {
            const ref = doc(db, 'users', user.uid);
            await setDoc(ref, {
                uid: user.uid,
                email: user.email || null,
                displayName: user.displayName || extra.displayName || null,
                photoURL: user.photoURL || null,
                provider: (user.providerData && user.providerData[0] && user.providerData[0].providerId) || 'password',
                lastLogin: serverTimestamp(),
                createdAt: serverTimestamp(),
                ...extra
            }, { merge: true });
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.location.href = '/map/map.html';
            }
        });

        $("btnRegister").addEventListener('click', async () => {
            clearError();
            const name = $("name").value.trim();
            const email = $("email").value.trim();
            const password = $("password").value;
            if (!name) return showError('Nama wajib diisi');
            if (!email || !password) return showError('Email dan password wajib diisi');
            try {
                const cred = await createUserWithEmailAndPassword(auth, email, password);
                if (name) await updateProfile(cred.user, { displayName: name });
                await upsertUser(cred.user, { displayName: name });
                window.location.href = '/map/map.html';
            } catch (e) {
                showError(e.message || 'Gagal mendaftar');
            }
        });

        $("btnGoogle").addEventListener('click', async () => {
            clearError();
            try {
                const result = await signInWithPopup(auth, provider);
                await upsertUser(result.user);
                window.location.href = '/map/map.html';
            } catch (e) {
                showError(e.message || 'Gagal daftar dengan Google');
            }
        });
    </script>
</body>
</html>


