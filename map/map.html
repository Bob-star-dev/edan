<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Location Tracker with Route</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Leaflet Routing Machine CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="map.css">
    <style>
    body {
        padding: 0;
        margin: 0;
    }
    </style>
</head>
<body>
<div id="map"></div>

<!-- Permission Request Popup - Modern Design -->
<div id="permissionPopup" class="permission-popup">
  <div class="permission-content">
    <div class="permission-icon">📍</div>
    <h2>Akses Lokasi Diperlukan</h2>
    <p>Aplikasi ini memerlukan akses ke lokasi Anda saat ini untuk menampilkan:</p>
    <ul>
      <li>📍 Lokasi Anda saat ini di peta</li>
      <li>🗺️ Rute dari lokasi Anda ke tujuan</li>
      <li>📍 Update lokasi setiap 1 detik (realtime)</li>
    </ul>
    <button id="requestPermissionBtn" onclick="requestLocationPermission()" class="permission-btn">
      Berikan Akses Lokasi
    </button>
    <p class="permission-hint">Setelah mengklik, browser akan meminta izin akses lokasi</p>
  </div>
</div>

<!-- Mobile Toggle Button (shown only on mobile) -->
<button id="mobileToggleBtn" class="mobile-toggle-btn" onclick="toggleStatusPanel()">
  📍 Info Lokasi
</button>

<!-- Debug Console Toggle Button -->
<button id="debugToggleBtn" class="debug-toggle-btn" onclick="toggleDebugPanel()" title="Toggle Debug Console">
  🐛 Debug
</button>

<!-- Status Panel -->
<div id="statusPanel" class="status-panel">
  <!-- Close button for mobile (shown only on mobile) -->
  <button id="closePanelBtn" class="close-panel-btn" onclick="toggleStatusPanel()" style="display: none;" aria-label="Tutup panel">✖️</button>
  
  <h3><span class="icon">📍</span> Track Your Location</h3>
  <p id="status">Waiting for location...</p>
  <p id="coordinates">Lat: -, Lng: -</p>
  <p id="accuracy">Accuracy: -</p>
  
  <div class="route-info">
    <h4>Live Route Tracking</h4>
    <p>Shows route from your current location to destination</p>
    <p class="route-update-info">Route updates every 1 second (realtime)</p>
  </div>
  
  <button id="retryBtn" class="retry-button">
    <span class="btn-icon">🔄</span>
    <span>Coba Lagi</span>
  </button>
</div>

<!-- Debug Console Panel -->
<div id="debugPanel" class="debug-panel">
  <!-- Close button for mobile (shown only on mobile) -->
  <button id="closeDebugBtn" class="close-panel-btn" onclick="toggleDebugPanel()" style="display: none;" aria-label="Tutup debug panel">✖️</button>
  
  <div class="debug-header">
    <h3><span class="icon">🐛</span> Debug Console</h3>
    <div class="debug-controls">
      <button id="clearDebugBtn" class="clear-debug-btn" onclick="clearDebugLogs()" title="Clear logs">🗑️ Clear</button>
      <button id="toggleAutoScrollBtn" class="auto-scroll-btn" onclick="toggleAutoScroll()" title="Toggle auto-scroll">📜 Auto</button>
    </div>
  </div>
  
  <div id="debugLogs" class="debug-logs">
    <p class="debug-placeholder">Console logs will appear here...</p>
  </div>
</div>

<!-- Voice Control Panel -->
<div class="voice-panel">
  <h4>🎤 Navigasi Suara</h4>
  <p>Ucapkan tujuan Anda untuk bernavigasi</p>
  
  <!-- Hidden button for voice control - accessible via screen reader -->
  <button id="voiceBtn" onclick="toggleVoiceListening()" style="display: none;" aria-label="Toggle voice listening" role="button" tabindex="-1">
    🎤 Aktifkan Mikrofon
  </button>
  
  <p id="voiceStatus" class="voice-status-text">
    Senavision Siap. Ucapkan Tujuan Anda.
  </p>
  
  <div class="voice-examples">
    <p class="voice-examples-title">💡 Percobaan perintah suara:</p>
    <p class="voice-examples-list">
      • "Jakarta" (langsung sebutkan kota)<br>
      • "Pergi ke Bandung" juga bisa<br>
      • "Mulai" (setelah tujuan ditetapkan)
    </p>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Leaflet Routing Machine JS -->
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

<!-- Custom JS -->
<script src="index.js"></script>
</body>
</html>